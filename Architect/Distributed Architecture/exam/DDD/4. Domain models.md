# Domain-Driven Design - Domain Models Diagrams

## Plateforme de Réservation d'Événements en Ligne

## 1. Event Catalog Service Domain Model

```mermaid
classDiagram
    class Event {
        <<Aggregate Root>>
        +EventId eventId
        +EventDetails details
        +EventStatus status
        +VenueInfo venue
        +OrganizerInfo organizer
        +DateTime createdAt
        +DateTime updatedAt
        +publish()
        +cancel()
        +updateDetails(EventDetails)
        +isPublished() bool
    }

    class EventDetails {
        <<Entity>>
        +String title
        +String description
        +EventCategory category
        +DateTime startDateTime
        +DateTime endDateTime
        +Integer venueCapacity
        +AgeRestrictions ageRestrictions
        +updateTitle(String)
        +updateDescription(String)
        +reschedule(DateTime, DateTime)
    }

    class EventId {
        <<Value Object>>
        +String value
        +equals(EventId) bool
        +toString() String
    }

    class EventStatus {
        <<Value Object>>
        +EventStatusEnum status
        +canTransitionTo(EventStatus) bool
        +isDraft() bool
        +isPublished() bool
        +isCancelled() bool
    }

    class VenueInfo {
        <<Value Object>>
        +String name
        +Address address
        +Coordinates coordinates
        +Integer capacity
        +String contactInfo
        +isValid() bool
    }

    class OrganizerInfo {
        <<Value Object>>
        +String organizerId
        +String name
        +String email
        +String phone
        +Boolean verified
        +isVerified() bool
    }

    class EventCategory {
        <<Value Object>>
        +String name
        +String description
        +List~String~ tags
        +equals(EventCategory) bool
    }

    class AgeRestrictions {
        <<Value Object>>
        +Integer minimumAge
        +Boolean requiresGuardian
        +isAllowed(Integer age) bool
    }

    Event --> EventId : has
    Event --> EventDetails : contains
    Event --> EventStatus : has
    Event --> VenueInfo : has
    Event --> OrganizerInfo : has
    EventDetails --> EventCategory : categorized as
    EventDetails --> AgeRestrictions : has
```

**Domain Events:**

- EventCreated
- EventPublished
- EventUpdated
- EventCancelled

---

## 2. Ticket Inventory Service Domain Model

```mermaid
classDiagram
    class TicketInventory {
        <<Aggregate Root>>
        +EventId eventId
        +List~TicketType~ ticketTypes
        +TotalCapacity totalCapacity
        +InventoryStatus status
        +DateTime createdAt
        +addTicketType(TicketType)
        +reserveTickets(TicketTypeId, Quantity) bool
        +releaseTickets(TicketTypeId, Quantity)
        +getTotalAvailable() Integer
        +isAvailable(TicketTypeId, Quantity) bool
    }

    class TicketType {
        <<Entity>>
        +TicketTypeId ticketTypeId
        +String name
        +String description
        +Price price
        +Quantity totalQuantity
        +Quantity availableQuantity
        +Quantity reservedQuantity
        +DateTime saleStartDate
        +DateTime saleEndDate
        +Boolean transferable
        +reserve(Quantity) bool
        +release(Quantity)
        +sell(Quantity) bool
        +isOnSale() bool
        +isAvailable(Quantity) bool
    }

    class TicketTypeId {
        <<Value Object>>
        +String value
        +equals(TicketTypeId) bool
        +toString() String
    }

    class Price {
        <<Value Object>>
        +BigDecimal amount
        +Currency currency
        +add(Price) Price
        +multiply(Integer) Price
        +isValidAmount() bool
    }

    class Quantity {
        <<Value Object>>
        +Integer value
        +add(Quantity) Quantity
        +subtract(Quantity) Quantity
        +isPositive() bool
        +isZero() bool
    }

    class TotalCapacity {
        <<Value Object>>
        +Integer value
        +isExceeded(Integer) bool
        +getRemainingCapacity(Integer) Integer
    }

    class InventoryStatus {
        <<Value Object>>
        +InventoryStatusEnum status
        +isAvailable() bool
        +isSoldOut() bool
        +isReserved() bool
    }

    TicketInventory --> EventId : for event
    TicketInventory --> TicketType : contains
    TicketInventory --> TotalCapacity : has
    TicketInventory --> InventoryStatus : has
    TicketType --> TicketTypeId : identified by
    TicketType --> Price : priced at
    TicketType --> Quantity : has quantities
```

**Domain Events:**

- InventoryCreated
- TicketsReserved
- TicketsReleased
- InventoryUpdated
- InventorySoldOut

---

## 3. Booking Service Domain Model

```mermaid
classDiagram
    class Reservation {
        <<Aggregate Root>>
        +ReservationId reservationId
        +UserId userId
        +EventId eventId
        +List~ReservationItem~ items
        +ReservationStatus status
        +ExpirationTime expirationTime
        +DateTime createdAt
        +Money totalAmount
        +confirm()
        +cancel()
        +expire()
        +addItem(ReservationItem)
        +removeItem(TicketTypeId)
        +calculateTotal() Money
        +isExpired() bool
        +canBeConfirmed() bool
    }

    class ReservationItem {
        <<Entity>>
        +TicketTypeId ticketTypeId
        +Quantity quantity
        +Price unitPrice
        +Money subTotal
        +updateQuantity(Quantity)
        +calculateSubTotal()
        +isValid() bool
    }

    class ReservationId {
        <<Value Object>>
        +String value
        +equals(ReservationId) bool
        +toString() String
    }

    class ReservationStatus {
        <<Value Object>>
        +ReservationStatusEnum status
        +canTransitionTo(ReservationStatus) bool
        +isPending() bool
        +isConfirmed() bool
        +isCancelled() bool
        +isExpired() bool
    }

    class ExpirationTime {
        <<Value Object>>
        +DateTime expirationDateTime
        +Integer timeoutMinutes
        +isExpired() bool
        +getRemainingTime() Duration
        +extend(Integer minutes)
    }

    class Money {
        <<Value Object>>
        +BigDecimal amount
        +Currency currency
        +add(Money) Money
        +subtract(Money) Money
        +multiply(Integer) Money
        +isPositive() bool
        +equals(Money) bool
    }

    Reservation --> ReservationId : identified by
    Reservation --> UserId : belongs to
    Reservation --> EventId : for event
    Reservation --> ReservationItem : contains
    Reservation --> ReservationStatus : has
    Reservation --> ExpirationTime : expires at
    Reservation --> Money : total amount
    ReservationItem --> TicketTypeId : for ticket type
    ReservationItem --> Quantity : quantity
    ReservationItem --> Price : unit price
    ReservationItem --> Money : subtotal
```

**Domain Events:**

- ReservationCreated
- ReservationConfirmed
- ReservationCancelled
- ReservationExpired
- ReservationItemAdded

---

## 4. Payment Service Domain Model

```mermaid
classDiagram
    class Payment {
        <<Aggregate Root>>
        +PaymentId paymentId
        +ReservationId reservationId
        +UserId userId
        +PaymentMethod paymentMethod
        +Money amount
        +PaymentStatus status
        +List~Transaction~ transactions
        +DateTime createdAt
        +String externalPaymentId
        +process()
        +refund(Money amount)
        +addTransaction(Transaction)
        +getTotalCharged() Money
        +getTotalRefunded() Money
        +canBeRefunded() bool
    }

    class Transaction {
        <<Entity>>
        +TransactionId transactionId
        +TransactionType type
        +Money amount
        +DateTime timestamp
        +String externalTransactionId
        +TransactionStatus status
        +String failureReason
        +isSuccessful() bool
        +isFailed() bool
    }

    class PaymentId {
        <<Value Object>>
        +String value
        +equals(PaymentId) bool
        +toString() String
    }

    class PaymentMethod {
        <<Value Object>>
        +PaymentMethodType type
        +String cardNumber
        +String cardHolderName
        +String expiryDate
        +String cvv
        +String billingAddress
        +isValid() bool
        +getMaskedCardNumber() String
    }

    class PaymentStatus {
        <<Value Object>>
        +PaymentStatusEnum status
        +canTransitionTo(PaymentStatus) bool
        +isPending() bool
        +isSucceeded() bool
        +isFailed() bool
        +isRefunded() bool
    }

    class TransactionId {
        <<Value Object>>
        +String value
        +equals(TransactionId) bool
    }

    class TransactionType {
        <<Value Object>>
        +TransactionTypeEnum type
        +isCharge() bool
        +isRefund() bool
        +isVoid() bool
    }

    class TransactionStatus {
        <<Value Object>>
        +TransactionStatusEnum status
        +isSuccessful() bool
        +isPending() bool
        +isFailed() bool
    }

    Payment --> PaymentId : identified by
    Payment --> ReservationId : for reservation
    Payment --> UserId : belongs to
    Payment --> PaymentMethod : uses
    Payment --> Money : amount
    Payment --> PaymentStatus : has
    Payment --> Transaction : contains
    Transaction --> TransactionId : identified by
    Transaction --> TransactionType : of type
    Transaction --> TransactionStatus : has
    Transaction --> Money : amount
```

**Domain Events:**

- PaymentInitiated
- PaymentSucceeded
- PaymentFailed
- RefundProcessed
- RefundFailed

---

## 5. User Management Service Domain Model

```mermaid
classDiagram
    class User {
        <<Aggregate Root>>
        +UserId userId
        +UserProfile profile
        +Authentication authentication
        +UserPreferences preferences
        +UserStatus status
        +DateTime registrationDate
        +DateTime lastLoginDate
        +updateProfile(UserProfile)
        +updatePreferences(UserPreferences)
        +authenticate(String password) bool
        +deactivate()
        +activate()
        +isActive() bool
    }

    class UserProfile {
        <<Entity>>
        +PersonalInfo personalInfo
        +ContactInfo contactInfo
        +DateTime dateOfBirth
        +String profileImageUrl
        +updatePersonalInfo(PersonalInfo)
        +updateContactInfo(ContactInfo)
        +isComplete() bool
    }

    class Authentication {
        <<Entity>>
        +String hashedPassword
        +String salt
        +List~AuthToken~ tokens
        +DateTime lastPasswordChange
        +Integer failedLoginAttempts
        +Boolean isLocked
        +changePassword(String newPassword)
        +generateToken() AuthToken
        +revokeToken(String tokenId)
        +isAccountLocked() bool
        +resetFailedAttempts()
    }

    class UserId {
        <<Value Object>>
        +String value
        +equals(UserId) bool
        +toString() String
    }

    class PersonalInfo {
        <<Value Object>>
        +String firstName
        +String lastName
        +String middleName
        +Gender gender
        +getFullName() String
        +isValid() bool
    }

    class ContactInfo {
        <<Value Object>>
        +Email email
        +PhoneNumber phone
        +Address address
        +isContactable() bool
    }

    class Email {
        <<Value Object>>
        +String value
        +isValid() bool
        +getDomain() String
    }

    class PhoneNumber {
        <<Value Object>>
        +String number
        +String countryCode
        +isValid() bool
        +getFormattedNumber() String
    }

    class UserPreferences {
        <<Value Object>>
        +Language preferredLanguage
        +Currency preferredCurrency
        +NotificationSettings notifications
        +Boolean marketingEmails
        +String timezone
    }

    class NotificationSettings {
        <<Value Object>>
        +Boolean emailNotifications
        +Boolean smsNotifications
        +Boolean pushNotifications
        +Boolean eventReminders
        +Boolean reservationUpdates
    }

    class UserStatus {
        <<Value Object>>
        +UserStatusEnum status
        +isActive() bool
        +isDeactivated() bool
        +isSuspended() bool
    }

    class AuthToken {
        <<Value Object>>
        +String tokenId
        +String token
        +DateTime expiresAt
        +TokenType type
        +isExpired() bool
        +isValid() bool
    }

    User --> UserId : identified by
    User --> UserProfile : has
    User --> Authentication : has
    User --> UserPreferences : has
    User --> UserStatus : has
    UserProfile --> PersonalInfo : contains
    UserProfile --> ContactInfo : contains
    ContactInfo --> Email : has
    ContactInfo --> PhoneNumber : has
    Authentication --> AuthToken : manages
    UserPreferences --> NotificationSettings : includes
```

**Domain Events:**

- UserRegistered
- UserAuthenticated
- ProfileUpdated
- UserDeactivated
- PasswordChanged

---

## 6. Notification Service Domain Model

```mermaid
classDiagram
    class NotificationCampaign {
        <<Aggregate Root>>
        +CampaignId campaignId
        +String name
        +List~UserId~ recipients
        +MessageTemplate template
        +NotificationChannel channel
        +CampaignStatus status
        +DateTime scheduledTime
        +DateTime createdAt
        +List~NotificationLog~ deliveryLogs
        +schedule(DateTime)
        +send()
        +cancel()
        +addRecipient(UserId)
        +getDeliveryStats() DeliveryStats
    }

    class MessageTemplate {
        <<Entity>>
        +TemplateId templateId
        +String subject
        +String body
        +MessageType messageType
        +List~String~ personalizationTokens
        +Boolean isHtml
        +personalize(Map~String,String~) String
        +validate() bool
        +preview(Map~String,String~) String
    }

    class NotificationLog {
        <<Entity>>
        +LogId logId
        +UserId recipient
        +NotificationChannel channel
        +DeliveryStatus status
        +DateTime attemptTime
        +DateTime deliveredTime
        +String failureReason
        +Integer retryCount
        +String externalMessageId
        +markAsDelivered()
        +markAsFailed(String reason)
        +canRetry() bool
    }

    class CampaignId {
        <<Value Object>>
        +String value
        +equals(CampaignId) bool
    }

    class TemplateId {
        <<Value Object>>
        +String value
        +equals(TemplateId) bool
    }

    class NotificationChannel {
        <<Value Object>>
        +ChannelType type
        +Map~String,String~ configuration
        +isEmail() bool
        +isSms() bool
        +isPush() bool
        +isInApp() bool
    }

    class MessageType {
        <<Value Object>>
        +MessageTypeEnum type
        +String description
        +Priority priority
        +isConfirmation() bool
        +isReminder() bool
        +isAlert() bool
    }

    class DeliveryStatus {
        <<Value Object>>
        +DeliveryStatusEnum status
        +isPending() bool
        +isSent() bool
        +isDelivered() bool
        +isFailed() bool
    }

    class CampaignStatus {
        <<Value Object>>
        +CampaignStatusEnum status
        +canTransitionTo(CampaignStatus) bool
        +isDraft() bool
        +isScheduled() bool
        +isSending() bool
        +isCompleted() bool
    }

    class DeliveryStats {
        <<Value Object>>
        +Integer totalRecipients
        +Integer delivered
        +Integer failed
        +Integer pending
        +Double deliveryRate
        +calculateDeliveryRate() Double
    }

    NotificationCampaign --> CampaignId : identified by
    NotificationCampaign --> UserId : targets
    NotificationCampaign --> MessageTemplate : uses
    NotificationCampaign --> NotificationChannel : via
    NotificationCampaign --> CampaignStatus : has
    NotificationCampaign --> NotificationLog : tracks
    MessageTemplate --> TemplateId : identified by
    MessageTemplate --> MessageType : of type
    NotificationLog --> UserId : for recipient
    NotificationLog --> NotificationChannel : via
    NotificationLog --> DeliveryStatus : has
```

**Domain Events:**

- NotificationSent
- DeliveryConfirmed
- DeliveryFailed
- CampaignCompleted

---

## 7. Streaming Service Domain Model

```mermaid
classDiagram
    class StreamSession {
        <<Aggregate Root>>
        +SessionId sessionId
        +EventId eventId
        +StreamConfig config
        +List~ViewerSession~ viewerSessions
        +StreamStatus status
        +DateTime startTime
        +DateTime endTime
        +StreamMetrics metrics
        +start()
        +end()
        +pause()
        +resume()
        +addViewer(UserId) ViewerSession
        +removeViewer(UserId)
        +getCurrentViewerCount() Integer
        +updateMetrics(StreamMetrics)
    }

    class StreamConfig {
        <<Entity>>
        +ConfigId configId
        +List~StreamQuality~ qualities
        +List~String~ cdnEndpoints
        +SecuritySettings security
        +Boolean recordingEnabled
        +String recordingPath
        +Integer maxViewers
        +updateQualitySettings(List~StreamQuality~)
        +addCdnEndpoint(String)
        +isRecordingEnabled() bool
    }

    class ViewerSession {
        <<Entity>>
        +ViewerSessionId sessionId
        +UserId userId
        +DateTime joinTime
        +DateTime leaveTime
        +Duration totalWatchTime
        +StreamQuality currentQuality
        +ConnectionMetrics connectionMetrics
        +Boolean isActive
        +updateQuality(StreamQuality)
        +recordBufferingEvent(Duration)
        +end()
        +getTotalWatchTime() Duration
    }

    class SessionId {
        <<Value Object>>
        +String value
        +equals(SessionId) bool
    }

    class StreamStatus {
        <<Value Object>>
        +StreamStatusEnum status
        +canTransitionTo(StreamStatus) bool
        +isScheduled() bool
        +isLive() bool
        +isPaused() bool
        +isEnded() bool
        +hasError() bool
    }

    class StreamQuality {
        <<Value Object>>
        +String resolution
        +Integer bitrate
        +String codec
        +Integer frameRate
        +isHighDefinition() bool
        +getBandwidthRequirement() Integer
    }

    class SecuritySettings {
        <<Value Object>>
        +Boolean requiresAuthentication
        +List~String~ allowedCountries
        +List~String~ blockedIPs
        +String encryptionKey
        +TokenExpirationTime tokenExpiry
        +generateAccessToken(UserId) AccessToken
    }

    class AccessToken {
        <<Value Object>>
        +String token
        +UserId userId
        +DateTime expiresAt
        +List~String~ permissions
        +isValid() bool
        +isExpired() bool
        +hasPermission(String) bool
    }

    class StreamMetrics {
        <<Value Object>>
        +Integer currentViewers
        +Integer peakViewers
        +Duration totalStreamTime
        +Double averageBitrate
        +Integer bufferingEvents
        +ConnectionQuality avgConnectionQuality
        +updateViewerCount(Integer)
        +recordBufferingEvent()
    }

    class ConnectionMetrics {
        <<Value Object>>
        +Double latency
        +Double bandwidth
        +Integer droppedFrames
        +ConnectionQuality quality
        +List~QualityEvent~ qualityEvents
        +getAverageQuality() ConnectionQuality
    }

    StreamSession --> SessionId : identified by
    StreamSession --> EventId : for event
    StreamSession --> StreamConfig : configured by
    StreamSession --> ViewerSession : contains
    StreamSession --> StreamStatus : has
    StreamSession --> StreamMetrics : tracks
    StreamConfig --> StreamQuality : supports
    StreamConfig --> SecuritySettings : secured by
    ViewerSession --> UserId : belongs to
    ViewerSession --> StreamQuality : uses
    ViewerSession --> ConnectionMetrics : tracks
    SecuritySettings --> AccessToken : generates
```

**Domain Events:**

- StreamStarted
- StreamEnded
- ViewerJoined
- ViewerLeft
- StreamQualityChanged
- StreamingError

---

## Shared Kernel - Common Domain Objects

```mermaid
classDiagram
    class EventId {
        <<Shared Value Object>>
        +String value
        +equals(EventId) bool
        +toString() String
        +isValid() bool
    }

    class UserId {
        <<Shared Value Object>>
        +String value
        +equals(UserId) bool
        +toString() String
        +isValid() bool
    }

    class Money {
        <<Shared Value Object>>
        +BigDecimal amount
        +Currency currency
        +add(Money) Money
        +subtract(Money) Money
        +multiply(Integer) Money
        +divide(Integer) Money
        +isPositive() bool
        +isZero() bool
        +equals(Money) bool
        +toString() String
    }

    class Timestamp {
        <<Shared Value Object>>
        +DateTime value
        +isBefore(Timestamp) bool
        +isAfter(Timestamp) bool
        +plusMinutes(Integer) Timestamp
        +plusHours(Integer) Timestamp
        +format(String pattern) String
    }

    class Address {
        <<Shared Value Object>>
        +String street
        +String city
        +String state
        +String postalCode
        +String country
        +Coordinates coordinates
        +getFullAddress() String
        +isValid() bool
    }

    class Coordinates {
        <<Shared Value Object>>
        +Double latitude
        +Double longitude
        +distanceTo(Coordinates) Double
        +isValid() bool
    }
```

## Integration Events Mapping

```mermaid
sequenceDiagram
    participant EC as Event Catalog
    participant TI as Ticket Inventory
    participant BS as Booking Service
    participant PS as Payment Service
    participant NS as Notification Service
    participant SS as Streaming Service

    EC->>TI: EventPublished
    TI->>TI: Create Inventory
    
    BS->>TI: Reserve Tickets
    TI->>BS: TicketsReserved
    
    BS->>PS: Initiate Payment
    PS->>PS: Process Payment
    PS->>BS: PaymentSucceeded
    
    BS->>TI: Confirm Reservation
    TI->>TI: Update Inventory
    
    BS->>NS: Send Confirmation
    NS->>NS: Send Notification
    
    EC->>SS: Event Started
    SS->>SS: Start Stream
```

## Domain Services and Factories

### Domain Services Needed:

1. **ReservationOrchestratorService** - Coordinates reservation process
2. **InventoryAvailabilityService** - Checks ticket availability across events
3. **PaymentProcessorService** - Handles external payment gateway integration
4. **StreamingOrchestratorService** - Manages streaming lifecycle
5. **NotificationDispatcherService** - Routes notifications to appropriate channels

### Factories:

1. **EventFactory** - Creates events with proper validation
2. **ReservationFactory** - Creates reservations with business rules
3. **PaymentFactory** - Creates payments with proper method validation
4. **StreamSessionFactory** - Creates streaming sessions with configuration
5. **NotificationCampaignFactory** - Creates notification campaigns with templates

